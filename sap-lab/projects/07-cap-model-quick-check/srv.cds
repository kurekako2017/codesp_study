*&---------------------------------------------------------------------*\n*& CAP 服务定义: srv.cds\n*& 说明: 定义 OData 服务和业务操作\n*& 功能: 暴露数据实体、定义投影、自定义操作\n*& 特点: 自动生成 REST/OData API\n*&---------------------------------------------------------------------*\n\n// 导入数据模型\nusing { sap.catalog } from '../db/data-model';\n\n// =====================================================\n// 产品目录服务\n// =====================================================\n// CatalogService 将自动生成 REST/OData 端点\nservice CatalogService {\n\n  // ===== 自定义类型 =====\n  // ProductInfo: 产品信息数据传输对象 (DTO)\n  // 用于 API 返回，可以不包含所有数据库字段\n  type ProductInfo {\n    id                  : UUID;         // 产品 ID\n    product_name        : String;       // 产品名称\n    description         : String;       // 产品描述\n    category            : String;       // 产品分类\n    price               : Decimal;      // 价格\n    currency            : String;       // 货币\n    stock_quantity      : Integer;      // 库存数量\n  }\n\n  // ===== 暴露实体 (以 OData 端点形式) =====\n  \n  // Products 实体\n  // 自动生成: GET /CatalogService/Products\n  //           POST /CatalogService/Products\n  //           PATCH /CatalogService/Products/:id\n  //           DELETE /CatalogService/Products/:id\n  entity Products as projection on catalog.Products;\n  \n  // Prices 实体\n  // 自动生成: GET /CatalogService/Prices\n  entity Prices as projection on catalog.Prices;\n\n  // Orders 实体 - 订单\n  // 自动生成: GET /CatalogService/Orders\n  entity Orders as projection on catalog.Orders;\n  \n  // OrderItems 实体 - 订单项\n  // 自动生成: GET /CatalogService/OrderItems\n  entity OrderItems as projection on catalog.OrderItems;\n\n  // ===== 只读视图 =====\n  // ProductList: 产品列表视图\n  // 说明: 定义一个只读视图，只包含需要的字段\n  define view ProductList as\n    select from catalog.Products {\n      id,                               // 产品 ID\n      product_name,                     // 产品名称\n      description,                      // 产品描述\n      category,                         // 产品分类\n      price,                            // 价格\n      currency,                         // 货币\n      stock_quantity                    // 库存数量\n    };\n  // 自动生成: GET /CatalogService/ProductList\n\n  // ===== Function (查询操作) =====\n  // getProductStock: 获取产品库存\n  // 说明: 根据产品 ID 查询库存数量\n  // 参数: product_id - 产品 UUID\n  // 返回: 产品 ID 和库存数量\n  // API 端点: GET /CatalogService/getProductStock?product_id=<UUID>\n  function getProductStock(product_id : UUID) returns {\n    product_id    : UUID;               // 产品 ID\n    stock_qty     : Integer;            // 库存数量\n  };\n\n  // ===== Action (业务操作) =====\n  // createOrder: 创建订单\n  // 说明: 创建新订单，包含多个订单项\n  // 参数:\n  //   customer_id: 客户 UUID\n  //   items: 订单项数组\n  //     - product_id: 产品 ID\n  //     - quantity: 数量\n  // 返回: 创建的订单对象 (Orders)\n  // API 端点: POST /CatalogService/createOrder\n  action createOrder(\n    customer_id   : UUID,                // 客户 UUID\n    items         : array of {           // 订单项数组\n      product_id  : UUID;                // 产品 ID\n      quantity    : Integer;             // 产品数量\n    }\n  ) returns Orders;                      // 返回创建的订单\n}
