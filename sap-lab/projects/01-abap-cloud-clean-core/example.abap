*&---------------------------------------------------------------------*
*& Report ZEXAMPLE_CLEAN_CORE
*&---------------------------------------------------------------------*
*& 程序名称: ZEXAMPLE_CLEAN_CORE
*& 程序说明: ABAP Cloud 示例程序 - 遵循 Clean Core 原则
*&          该程序演示如何使用面向对象的方式组织代码，
*&          将业务逻辑分离到单独的服务类中
*& 创建人: 系统
*& 创建日期: 2025-12-31
*&---------------------------------------------------------------------*

REPORT zexample_clean_core.

*----------------------------------------------------------------------*
* 全局数据定义区域
* 说明: 定义全局变量和数据结构，用于存储产品信息
*----------------------------------------------------------------------*
DATA: lt_products TYPE TABLE OF zproduct_t,    " 产品列表 (内表)
      ls_product  TYPE zproduct_t.             " 单个产品 (结构)

*----------------------------------------------------------------------*
* 业务逻辑类定义 - lcl_product_service
* 说明: 这是一个本地类(lcl)，包含所有产品相关的业务逻辑
*       遵循 Clean Core 原则：
*       1. 关注点分离 - 将业务逻辑与报表逻辑分开
*       2. 单一职责 - 每个方法只负责一个业务功能
*       3. 易于测试 - 可以独立测试业务逻辑
*       4. 易于维护 - 代码组织清晰，易于理解和修改
*----------------------------------------------------------------------*
CLASS lcl_product_service DEFINITION.
  " =====================================================
  " 公开部分 - 定义该类对外暴露的接口
  " =====================================================
  PUBLIC SECTION.
    
    "-----------------------------------------------------
    " 方法1: get_products - 获取产品列表
    " 说明: 从数据库查询所有产品信息
    " 返回值: rt_products - 产品列表内表
    "-----------------------------------------------------
    METHODS get_products
      RETURNING VALUE(rt_products) TYPE TABLE OF zproduct_t.
    
    "-----------------------------------------------------
    " 方法2: create_product - 创建新产品
    " 说明: 将新产品信息插入到数据库
    " 参数: is_product - 要创建的产品对象
    " 返回值: rv_success - 是否创建成功 (true/false)
    "-----------------------------------------------------
    METHODS create_product
      IMPORTING is_product TYPE zproduct_t
      RETURNING VALUE(rv_success) TYPE abap_bool.

ENDCLASS.

*----------------------------------------------------------------------*
* 业务逻辑类实现 - lcl_product_service
* 说明: 实现上面定义的所有业务逻辑方法
*----------------------------------------------------------------------*
CLASS lcl_product_service IMPLEMENTATION.

  "-------------------------------------------------------
  " 方法实现: get_products
  " 功能: 从 zproducts 表中查询所有产品
  " 逻辑流程:
  "   1. 执行 SELECT 语句从数据库获取数据
  "   2. 将查询结果存储到返回参数中
  "   3. 返回包含所有产品的列表
  "-------------------------------------------------------
  METHOD get_products.
    " 获取产品列表业务逻辑
    " SELECT * 查询所有字段
    " FROM zproducts 从产品表
    " INTO TABLE rt_products 放入返回的内表
    SELECT * FROM zproducts INTO TABLE rt_products.
  ENDMETHOD.

  "-------------------------------------------------------
  " 方法实现: create_product
  " 功能: 将新产品信息插入数据库
  " 逻辑流程:
  "   1. 接收产品参数
  "   2. 执行 INSERT 语句插入数据库
  "   3. 检查 sy-subrc 系统返回码判断是否成功
  "   4. 返回成功标记 (true 成功，false 失败)
  "-------------------------------------------------------
  METHOD create_product.
    " 创建产品业务逻辑
    " INSERT zproducts FROM is_product 将产品对象插入数据库
    INSERT zproducts FROM is_product.
    
    " ===== 错误检查 =====
    " sy-subrc 是 ABAP 的系统变量，存储上一条语句的执行结果
    " 0 表示成功，非 0 表示失败
    IF sy-subrc = 0.
      " 插入成功，返回 true
      rv_success = abap_true.
    ELSE.
      " 插入失败，返回 false
      rv_success = abap_false.
    ENDIF.
  ENDMETHOD.

ENDCLASS.

*----------------------------------------------------------------------*
* 主程序入口点
* 说明: START-OF-SELECTION 是报表程序的主入口
*       此部分代码在用户点击"执行"(F8)后执行
*----------------------------------------------------------------------*
START-OF-SELECTION.
  
  "-----------------------------------------------------
  " 第1步: 创建服务对象实例
  "-----------------------------------------------------
  " 使用 NEW 操作符创建 lcl_product_service 类的实例
  " lo_service 是对该实例的引用(对象指针)
  DATA(lo_service) = NEW lcl_product_service( ).
  
  "-----------------------------------------------------
  " 第2步: 调用业务方法获取产品列表
  "-----------------------------------------------------
  " 调用 get_products() 方法从数据库获取所有产品
  " 将返回的列表保存到全局变量 lt_products
  lt_products = lo_service->get_products( ).
  
  "-----------------------------------------------------
  " 第3步: 输出结果到屏幕
  "-----------------------------------------------------
  " WRITE 命令用于输出内容到屏幕
  " / 表示新起一行
  " lines( lt_products ) 函数返回内表中的行数
  WRITE: / 'Product Count:', lines( lt_products ).
  
  "-----------------------------------------------------
  " 第4步: 输出详细信息
  "-----------------------------------------------------
  " 如果查询到产品，输出产品列表头部信息
  IF lines( lt_products ) > 0.
    WRITE: / '--------- 产品列表 ---------'.
    LOOP AT lt_products INTO ls_product.
      WRITE: / 'Product ID:', ls_product-product_id.
    ENDLOOP.
  ELSE.
    WRITE: / '无产品信息'.
  ENDIF.
